<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SoundTag</title>
  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0b0b10;
      color: #f5f5f7;
    }
    h1 {
      margin: 0 0 12px;
      font-size: 1.4rem;
      font-weight: 600;
    }
    .card {
      background: #161621;
      border-radius: 14px;
      padding: 14px;
      margin-bottom: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.45);
    }
    .upload {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    input[type="file"] {
      color: #ccc;
    }
    .list {
      display: flex;
      flex-direction: column;
    }
    .item {
      padding: 14px 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.15s ease;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .item:hover {
      background: rgba(255,255,255,0.06);
    }
    .item:active {
      background: rgba(47,128,255,0.25);
    }
    .name {
      font-size: 0.95rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .badge {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      opacity: 0.7;
    }
    .stop {
      width: 100%;
      padding: 12px;
      font-size: 0.95rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #ff4d5a;
      color: white;
    }
    .status {
      font-size: 0.75rem;
      opacity: 0.6;
      margin-top: 6px;
    }
  </style>
</head>
<body>

  <h1>SoundTag</h1>

  <div class="card upload">
    <strong>Upload sound</strong>
    <input id="fileInput" type="file" accept="audio/*" />
    <div id="uploadStatus" class="status"></div>
  </div>

  <div class="card">
    <strong>Sounds</strong>
    <div id="list" class="list status">Loading…</div>
  </div>

  <div class="card">
    <button class="stop" id="stopBtn">Stop (Silent)</button>
    <div class="status">All listeners remain connected</div>
  </div>

<script>
  const list = document.getElementById("list");
  const fileInput = document.getElementById("fileInput");
  const uploadStatus = document.getElementById("uploadStatus");
  const stopBtn = document.getElementById("stopBtn");

  async function loadFiles() {
    list.textContent = "Loading…";
    try {
      const res = await fetch("/files");
      const files = await res.json();

      if (!files.length) {
        list.textContent = "No sounds uploaded.";
        return;
      }

      list.innerHTML = "";
      files.forEach(name => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div class="name">${name}</div>
          <div class="badge">tap</div>
        `;
        div.onclick = () => {
          fetch("/play/" + encodeURIComponent(name), { method: "POST" });
        };
        list.appendChild(div);
      });
    } catch {
      list.textContent = "Failed to load sounds.";
    }
  }

  fileInput.onchange = async () => {
    const file = fileInput.files[0];
    if (!file) return;

    uploadStatus.textContent = "Uploading…";
    const data = new FormData();
    data.append("file", file);

    try {
      const res = await fetch("/upload", { method: "POST", body: data });
      if (!res.ok) throw new Error();
      uploadStatus.textContent = "Uploaded";
      fileInput.value = "";
      loadFiles();
    } catch {
      uploadStatus.textContent = "Upload failed";
    }
  };

  stopBtn.onclick = async () => {
    stopBtn.disabled = true;
    await fetch("/stop", { method: "POST" });
    setTimeout(() => stopBtn.disabled = false, 400);
  };

  loadFiles();
</script>

</body>
</html>
